@media (max-width: 1200px) {
    .main {
        max-width: 100%;
        padding: var(--spacing-md) var(--spacing-sm);
    }
    
    .controls-panel {
        width: 280px;
    }
    
    .visualization-container {
        min-height: 500px;
    }
}

@media (max-width: 1024px) {
    .header-content {
        padding: 0 var(--spacing-sm);
    }
    
    .main {
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .controls-panel {
        width: 100%;
        position: static;
        order: -1;
    }
    
    .visualization-container {
        min-height: 400px;
        order: 1;
    }
    
    .performance-overlay {
        top: var(--spacing-sm);
        left: var(--spacing-sm);
        font-size: 0.75rem;
    }
    
    .legend {
        bottom: var(--spacing-sm);
        left: var(--spacing-sm);
        padding: var(--spacing-sm);
    }
    
    .legend-title {
        font-size: 0.8rem;
    }
    
    .legend-label {
        font-size: 0.75rem;
    }
}

@media (max-width: 768px) {
    .header {
        padding: var(--spacing-sm);
    }
    
    .header-content {
        flex-wrap: wrap;
        gap: var(--spacing-sm);
    }
    
    .title {
        order: 1;
        flex: 1;
    }
    
    .header-controls {
        order: 2;
    }
    
    .main {
        padding: var(--spacing-sm);
        gap: var(--spacing-sm);
    }
    
    .controls-panel {
        padding: var(--spacing-md);
        border-radius: var(--border-radius-small);
    }
    
    .visualization-container {
        min-height: 350px;
        border-radius: var(--border-radius-small);
    }
    
    .step-indicator {
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-md);
    }
    
    .parameters-section,
    .animation-section {
        margin-bottom: var(--spacing-md);
    }
    
    .section-title {
        font-size: 1rem;
        margin-bottom: var(--spacing-sm);
    }
    
    .parameter-group {
        gap: var(--spacing-sm);
    }
    
    .control-buttons {
        gap: var(--spacing-xs);
    }
    
    .modal-content {
        max-width: 95%;
        margin: var(--spacing-md);
    }
    
    .footer-content {
        flex-direction: column;
        gap: var(--spacing-sm);
        text-align: center;
    }
    
    .footer-shortcuts {
        flex-wrap: wrap;
        justify-content: center;
        gap: var(--spacing-sm);
    }
}

@media (max-width: 640px) {
    .title-main {
        font-size: 1.1rem;
    }
    
    .title-sub {
        font-size: 0.75rem;
    }
    
    .header-controls {
        gap: var(--spacing-xs);
    }
    
    .btn-icon {
        min-width: 28px;
        padding: var(--spacing-xs);
    }
    
    .btn-icon .icon {
        font-size: 1em;
    }
    
    .visualization-container {
        min-height: 300px;
    }
    
    .performance-overlay {
        position: static;
        background-color: transparent;
        backdrop-filter: none;
        padding: var(--spacing-xs);
        margin-bottom: var(--spacing-sm);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-small);
    }
    
    .legend {
        position: static;
        background-color: transparent;
        backdrop-filter: none;
        padding: var(--spacing-xs);
        margin-top: var(--spacing-sm);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-small);
    }
    
    .legend-items {
        flex-direction: row;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
    }
    
    .controls-panel {
        padding: var(--spacing-sm);
    }
    
    .step-nav {
        gap: var(--spacing-sm);
    }
    
    .step-title {
        font-size: 1rem;
    }
    
    .step-description {
        font-size: 0.85rem;
    }
    
    .code-block {
        font-size: 0.7rem;
        padding: var(--spacing-sm);
    }
    
    .parameter-label {
        font-size: 0.8rem;
    }
    
    .control-buttons {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
    
    .control-buttons .btn {
        min-height: 36px;
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .app {
        min-height: 100vh;
    }
    
    .header {
        padding: var(--spacing-xs);
    }
    
    .header-content {
        gap: var(--spacing-xs);
    }
    
    .title-main {
        font-size: 1rem;
    }
    
    .title-sub {
        font-size: 0.7rem;
    }
    
    .main {
        padding: var(--spacing-xs);
        gap: var(--spacing-xs);
    }
    
    .visualization-container {
        min-height: 250px;
    }
    
    .controls-panel {
        padding: var(--spacing-sm);
    }
    
    .step-indicator {
        padding: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
    }
    
    .step-title {
        font-size: 0.9rem;
    }
    
    .step-description {
        font-size: 0.8rem;
    }
    
    .step-code {
        padding: var(--spacing-sm);
        margin-top: var(--spacing-sm);
    }
    
    .code-block {
        font-size: 0.65rem;
        line-height: 1.3;
    }
    
    .section-title {
        font-size: 0.9rem;
    }
    
    .parameter-group {
        gap: var(--spacing-xs);
    }
    
    .parameter-item {
        gap: var(--spacing-xs);
    }
    
    .parameter-label {
        font-size: 0.75rem;
    }
    
    .slider {
        height: 6px;
    }
    
    .slider::-webkit-slider-thumb {
        width: 18px;
        height: 18px;
    }
    
    .slider::-moz-range-thumb {
        width: 18px;
        height: 18px;
    }
    
    .control-buttons .btn {
        min-height: 32px;
        font-size: 0.75rem;
        padding: var(--spacing-xs) var(--spacing-sm);
    }
    
    .btn-text {
        font-size: 0.75rem;
    }
    
    .modal-content {
        max-width: 100%;
        margin: var(--spacing-xs);
        border-radius: var(--border-radius);
    }
    
    .modal-header,
    .modal-body {
        padding: var(--spacing-sm);
    }
    
    .modal-title {
        font-size: 1.2rem;
    }
    
    .footer {
        padding: var(--spacing-sm);
    }
    
    .footer-text {
        font-size: 0.8rem;
    }
    
    .shortcut {
        font-size: 0.7rem;
        padding: 2px var(--spacing-xs);
    }
}

@media (max-width: 360px) {
    .header-content {
        flex-direction: column;
        align-items: center;
    }
    
    .title {
        text-align: center;
        margin-bottom: var(--spacing-xs);
    }
    
    .visualization-container {
        min-height: 200px;
    }
    
    .step-nav {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
    
    .step-info {
        order: -1;
    }
    
    .legend-items {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
    
    .footer-shortcuts {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
}

@media (orientation: landscape) and (max-height: 600px) {
    .main {
        flex-direction: row;
    }
    
    .controls-panel {
        width: 280px;
        height: calc(100vh - 120px);
        overflow-y: auto;
        position: sticky;
        top: 80px;
    }
    
    .visualization-container {
        min-height: calc(100vh - 120px);
    }
    
    .step-indicator {
        padding: var(--spacing-sm);
    }
    
    .step-title {
        font-size: 0.9rem;
    }
    
    .step-description {
        font-size: 0.8rem;
    }
    
    .parameters-section,
    .animation-section {
        margin-bottom: var(--spacing-sm);
    }
    
    .section-title {
        font-size: 0.9rem;
        margin-bottom: var(--spacing-xs);
    }
    
    .parameter-group {
        gap: var(--spacing-xs);
    }
}

@media (hover: none) and (pointer: coarse) {
    .btn:hover {
        background-color: var(--surface-light);
        border-color: var(--border-color);
        box-shadow: none;
    }
    
    .btn-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .slider:hover {
        background: var(--surface-light);
    }
    
    .slider::-webkit-slider-thumb:hover {
        background: var(--primary-color);
        transform: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .slider::-moz-range-thumb:hover {
        background: var(--primary-color);
        transform: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .modal-close:hover {
        background-color: var(--surface-color);
        color: var(--text-secondary);
    }
}

@media (prefers-color-scheme: light) {
    :root {
        --background-color: #ffffff;
        --surface-color: #f5f5f5;
        --surface-light: #e0e0e0;
        --text-color: #000000;
        --text-secondary: #333333;
        --text-muted: #666666;
        --border-color: #cccccc;
        --shadow-color: rgba(0, 0, 0, 0.1);
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .loading-spinner {
        animation: none;
        border-top-color: var(--primary-color);
    }
    
    .modal-content {
        animation: none;
    }
}

@media (prefers-contrast: high) {
    :root {
        --border-color: #ffffff;
        --text-secondary: #ffffff;
        --text-muted: #cccccc;
    }
    
    .btn {
        border-width: 2px;
    }
    
    .slider {
        border: 2px solid var(--border-color);
    }
}

@supports (backdrop-filter: blur(4px)) {
    .performance-overlay,
    .legend {
        backdrop-filter: blur(4px);
    }
    
    .modal {
        backdrop-filter: blur(4px);
    }
}

@supports not (backdrop-filter: blur(4px)) {
    .performance-overlay,
    .legend {
        background-color: rgba(0, 0, 0, 0.9);
    }
    
    .modal {
        background-color: rgba(0, 0, 0, 0.9);
    }
}

@supports (display: grid) {
    .parameter-grid {
        display: grid;
    }
}

@supports not (display: grid) {
    .parameter-grid {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }
    
    .parameter-grid .parameter-item {
        flex: 1 1 100%;
    }
    
    .parameter-grid .parameter-item.half {
        flex: 1 1 calc(50% - var(--spacing-md));
    }
}

@media print {
    .header-controls,
    .controls-panel,
    .performance-overlay,
    .modal,
    .loading-overlay {
        display: none !important;
    }
    
    .main {
        flex-direction: column;
    }
    
    .visualization-container {
        width: 100%;
        height: 400px;
        border: 2px solid #000;
    }
    
    .footer-shortcuts {
        display: none;
    }
}